## 说明

## 一、概述

### 使用场景

> 经销商自己有一套系统，想在这个基础上扩充相关功能。 经销商的客户的账号由经销商自己的系统管理，用于登录经销商的系统。 经销商系统的账号和智位星在线平台的账号对应关系，经销商自己管理，经销商使用智位星在线平台的账号来获取相应设备数据。设备`IMEI`由经销商自己的系统管理，经销商可根据`IMEI`获取设备数据。 经销商的应用服务器调用API接口。

### 使用方法

> 经销商使用智位星在线平台分配的登录账号，登录密码调用`api`接口获取访问令牌`access_token`。 经销商在应用服务器端使用`access_token`访问`openApi`接口获取所需的数据。所有接口请求必须使用智位星在线平台分配的`app_key`,`app_secret`进行签名（签名方式详见[公共请求参数说明](#first_link)），不合法请求会被API服务器拒绝访问。

### 调用地址

+   生产环境：`http://113.44.69.253:1987/`

* * *

## 二、公用约定

> 服务器默认采用`UTF-8`编码，数据采用`JSON`格式  
> 请求：`Context-Type:application/json charset=utf-8`  
> 响应：`Context-Type:application/json charset=utf-8`  
> 响应数据中默认不返回内容为null的字段  
> 时间统一采用`GMT+8`时间，格式`yyyy-MM-dd HH:mm:ss`,`yyyy-MM-dd`

\* 非必填参数为空时：  
方式一：请求时直接不携带该参数，此时加密算法中第①步该参数无需参与排序；  
方式二：请求时携带该参数，此时加密算法中第①步该参数需要参与排序。第③步将参数名称替换成具体值时，值为空，但前后 \_ 需要携带。

* * *

## 三、接口调用流程
## 四、调用次数及费用

> 1.开通功能（提供appkey及appsecret）的费用，按照名下设备计算（例：N元/每台设备，具体同对接人员确认），默认1440次调用/天/每个接口；  
> 2.若默认调用额度不够，每增加1440次/天/接口的费用也按照名下设备计算（例：N元/每台设备，具体同对接人员确认）。

## 五、请求及响应

### 公共请求参数（所有请求必须携带以下参数）

##### 根据接口请求方式的不同，公共参数放在请求体中`POST`或url拼接`GET`

| 参数名称 | 参数类型 | 是否必填 | 参数说明 | 取值说明 | 默认值 |
| --- | --- | --- | --- | --- | --- |
| method | string | 是 | API接口名称 |  |  |
| timestamp | string | 是 | 时间戳，格式为yyyy-MM-dd HH:mm:ss允许与系统时间误差正负10分钟，例如：2023-08-25 20:00:00 |  |  |
| appKey | string | 是 | 智位星分配的APP\_KEY |  |  |
| sign | string | 是 | 签名 示例：D9800AF8C2A1DBC00EE302A3356C582D，
加密方式（非必填参数为空时，请参照二、公共约定中说明）：  
①使用下划线`_`连接每个参数名称内容（公共参数，加上单独接口的请求参数，但除去sign参数和array数组类型的参数），  
②根据参数名称的ASCII码表的顺序排序，并在首尾拼接智位星分配的appSecret，  
③将参数名称替换成具体的参数，  
④对该内容进行MD5加密后，取32位大写。

 |  |  |
| signMethod | string | 是 | 可选，指定签名方式。系统默认md5，支持方式有：md5 | md5 | md5 |
| v | string | 是 | 可选，指定API版本。1.0校验签名，1.29 不校验签名 （不校验签名时，`sign`字段不得为空，可使用示例签名） | 1.0 | 1.0 |
| format | string | 是 | 可选，指定响应格式。系统默认json | json | json |

### 签名示例

请求参数：

```
{
  "method": "open.device.distribution",
  "timestamp": "2023-09-02 16:30:01",
  "appKey": "85a3ce23123b52b0",
  "sign": "9316A91FA4054078F0C7ADD302C475C5",
  "signMethod": "md5",
  "v": "1.0",
  "format": "json",
  "accessToken": "5aced6c812323403aa6cad79c00c48",
  "imeiList": [
    "5414888"
  ],
  "destAccount": "test"
}
```

具体操作示例：

将参数名称根据ASCII码表的顺序排序，把参数值使用`_`拼接在一起(`除去sign参数和array数组类型的参数`)，根据上述的请求参数得到的结果为：`accessToken_appKey_destAccount_format_method_signMethod_timestamp_v`,

拼接完成后在结果的首尾加上appsecret为`appsecret_accessToken_appKey_destAccount_format_method_signMethod_timestamp_v_appsecret`，

将参数名称替换成实际参数：`f48c1a08c48c7d895def8b2a2eace_5aced6c812323403aa6cad79c00c48_85a3ce23123b52b0_test_json_open.device.distribution_md5_2023-09-02 16:30:01_1.0_f48c1a08c48c7d895def8b2a2eace`,

对结果进行MD5加密（取32位大写)为9316A91FA4054078F0C7ADD302C475C5。

\*以上仅为示例，请不要直接使用该内容进行测试！

### 通用响应参数

| 参数名称 | 参数类型 | 是否必填 | 参数说明 | 取值说明 | 默认值 |
| --- | --- | --- | --- | --- | --- |
| code | Integer | 是 | 返回状态码 | 1000 |  |
| msg | string | 是 | 返回状态码描述 | 操作成功 |  |
| data | obj | 是 | 返回数据，不存在返回数据则为空 |  |  |

### 返回状态码说明

| code | 值 | 描述 |
| --- | --- | --- |
| 1xxx | 1000 | 操作成功 |
| 2xxx | 2000 | 无数据 |
| 3xxx | 3000 | 参数错误，`msg`字段返回具体错误参数名称 |
|  | 3001 | 时间戳异常，通用请求参数中的`timestamp`时间戳异常 |
| 4xxx | 4000 | 业务逻辑异常，`msg`字段为具体异常信息 |
| 5xxx | 5000 | 请先登录，请求参数`access_token`不存在或已过期 |
| 6xxx | 6000 | 无权访问 |
|  | 6001 | 触发接口每日请求限制 |
|  | 6002 | 触发IP请求限制 |
|  | 6003 | 触发接口每秒请求限制 |
|  | 6004 | 方法名匹配异常，请求参数`method`错误 |
|  | 6005 | 签名错误 |
| 7xxx | 7000 | 访问超时 |
| 9xxxx | 90000 | 系统异常 |

文档更新时间: 2024-11-20 14:31   作者：武俊升